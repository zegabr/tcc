Para avaliar esta nova versão do \emph{CSDiff} e responder as perguntas de pesquisa mencionadas anteriormente, repetimos
o experimento feito em~\cite{heitor21,clem21}, que compara os resultados de utilizar \emph{CSDiff} com o resultado
de utilizar \emph{diff3}, analisando o potencial para resolução de conflitos sem gerar impacto negativo na corretude do
processo de \emph{merge}. Como meio de facilitar a execução desta análise, foi utlizado o \emph{miningframework}, que
automatiza o processo de coletar os cenários de merge, além de executar as ferramentas \emph{CSDiff} e \emph{diff3} em
cada arquivo de cada cenário.

\section{CONCEITOS}
A seguir, alguns conceitos relevantes para a avaliação serão definidos.
\subsection{Cenário de Merge}
Em um sistema de controle de versão, um \emph{commit} é uma versão que agrupa mudanças em
determinados arquivos de um projeto~\cite{koc11}.
Considerando essa definição, um Cenário de Merge é definido como uma quádrupla de \emph{commits},
que chamaremos aqui de \emph{base},
\emph{left}, \emph{right} e \emph{merge}. O \emph{base} representa o \emph{commit} de onde as modificações \emph{left} e \emph{right}
partiram, enquanto o \emph{merge} representa a versão final onde a integração das mudanças foi feita no repositório.
\subsection{Falso Positivo Adicionado}
Seguindo as mesmas definições descritas em~\cite{clem21},
um falso positivo ocorre quando a ferramenta de merge relata um conflito
que na verdade não deveria ter ocorrido, ou seja, as
mudanças que estão sendo integradas
não interferem uma na outra. Para comparar duas ferramentas de merge
X e Y, usamos o conceito de Falso Positivo Adicionado \emph{aFP}, que acontece quando
a ferramenta X relata conflito em um determinado cenário de merge,
enquanto a ferramenta Y não relata conflito no mesmo cenário e
as mudanças integradas pelas ferramentas não interferem uma na outra.
É importante usar o conceito de aFP porque o conjunto de falsos conflitos
de uma ferramenta não é um subconjunto da outra.
\subsection{Falso Negativo Adicionado}
Um falso negativo ocorre quando a ferramenta de merge não relata um conflito
que deveria ter sido reportado, pois as mudanças que estão sendo integradas
interferem uma na outra. Ao comparar duas ferramentas de merge X e Y,
usamos o conceito de Falso Negativo Adicionado (\emph{aFN}), que acontece quando a ferramenta X
não relata conflito em um determinado cenário de merge, enquanto a ferramenta Y
relata conflito no mesmo cenário e as mudanças que estão sendo integradas pelas
ferramentas interferem uma na outra (ou seja, deveria ocorrer conflito).
É importante usar o conceito de aFN porque o conjunto de falsos negativos de uma
ferramenta não é um subconjunto da outra.

\section{PERGUNTAS DE PESQUISA}
A avaliação desta pesquisa é baseada em responder as seguintes perguntas de pesquisa.
\subsection{PP1: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	reduz a quantidade de conflitos reportados em comparação ao \emph{merge} puramente textual?}
Para avaliar o número de conflitos gerados pelo \emph{diff3} e \emph{CSDiff}, contamos
o número de conflitos em cada ferramenta para cada cenário de merge. Para isso,
executamos a ferramenta para os conjuntos de arquivos de \emph{left}, \emph{right} e \emph{base} em cada cenário,
resultando em um conjunto de arquivos combinados. Em seguida, contamos a ocorrência
de marcadores de conflito para cada arquivo presente nesses conjuntos, que são sequências
de caracteres apresentados no formato de conflito descrito na Figura~\ref{diff3_example}.
\subsection{PP2: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	reduz a quantidade de cenários com conflitos reportados em comparação ao \emph{merge} puramente textual?}
Para avaliar o número de cenários de merge com conflitos gerados pelo \emph{diff3}
e \emph{CSDiff}, contamos o número de cenários em cada ferramenta em que houve conflito.
Para isso, executamos a ferramenta para os conjuntos de arquivos de \emph{left}, \emph{right} e
\emph{base} em cada cenário de merge, resultando em um conjunto de arquivos combinados. Um
cenário é considerado com conflito se pelo menos um arquivo no conjunto resultante do merge tiver
um conflito.
\subsection{PP3: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	reduz a quantidade de falsos conflitos e cenários com falsos conflitos reportados
	(falsos positivos) em comparação ao \emph{merge} puramente textual?}
Para responder a esta pergunta, foram contabilizados os casos em que uma
ferramenta apresentou um falso positivo adicionado (\emph{aFP}) em relação à outra.
Para verificar se um cenário continha um \emph{aFP} do \emph{diff3} em comparação com o \emph{CSDiff},
foi verificado se o \emph{diff3} retornou pelo menos um conflito em pelo menos um dos arquivos integrados no cenário,
enquanto o \emph{CSDiff} não retornou nenhum conflito para todos os arquivos do cenário e obteve o resultado correto do merge.
Neste caso, foi contabilizado que o \emph{diff3} tinha um cenário com \emph{aFP} em relação ao \emph{CSDiff}.
O mesmo procedimento foi realizado para encontrar \emph{aFPs} adicionados pelo \emph{CSDiff} em comparação com o \emph{diff3}.
\subsection{PP4: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	amplia a possibilidade de comprometer a corretude do código, por aumentar o número de
	integrações de mudanças que interferem uma na outra, sem reportar conflitos (falsos negativos),
	além de aumentar cenários com falsos negativos?}
Para verificar se um cenário possui um \emph{aFN} para uma ferramenta em comparação com outra,
o merge foi executado usando tanto o \emph{diff3} quanto o \emph{CSDiff}. Se o \emph{CSDiff} não retornasse nenhum
conflito em nenhum arquivo resultante do merge no conjunto de arquivos do cenário, enquanto o
\emph{diff3} retornasse conflito e o \emph{CSDiff} falhasse na integração das mudanças, esse cenário seria
contado como um \emph{aFN} para o \emph{CSDiff}. Falhar na integração significa que a ferramenta resultou em um
código sintaticamente incorreto ou que não preserva os comportamentos esperados individualmente pelas
mudanças de \emph{left} e \emph{right}. Esse procedimento também foi realizado para encontrar falsos negativos
adicionados pelo \emph{diff3} em comparação com o \emph{CSDiff}. Para verificar esses casos de falsos negativos,
os códigos foram analisados manualmente.
\subsection{PP5: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	demonstra um aumento de produtividade considerando o ato de resolver conflitos de merge?}
% TODO: adicionar um exemplo visual em cada um
Além das 4 primeiras perguntas de pesquisa, foi criada uma outra forma de analisar os benefícios do \emph{CSDiff} em relação ao
\emph{diff3}.
Para tal, foram definidas as 4 situações abaixo e cada situação foi associada a uma pontuação, de forma que
uma maior pontuação em um determinado arquivo ou cenário, indica um aumento na produtividade do desenvolvedor ao
utilizar o \emph{CSDiff} como ferramenta ao invés do \emph{diff3}. Essa análise foi feita manualmente comparando para cada
arquivo
de cada cenário de merge, os conflitos relatados pela
ferramenta \emph{CSDiff} e \emph{diff3}, bem como foi comparado seus resultados
com o resultado final do merge, nos casos onde um deles não relatava conflitos. Essa análise foi possível pois, apesar de
a amostra ter sido consideravelmente grande (mais de 3000 cenários de merge), houveram aproximadamente 30 cenários onde
tais comportamentos fossem possíveis de acontecer. Isso será melhor explicado na seção \ref{metodologia}.
\subsubsection{Conflito Reduzido}
Um Conflito Reduzido é definido como um conflito que ocorre na ferramenta \emph{diff3} e na ferramenta \emph{CSDiff},
mas que no resultado do \emph{CSDiff} esse conflito está consideravelmente reduzido (possui um tamanho menor). Dessa forma,
a pontuação escolhida para o aumento de produtividade nessa situação foi +1, dado que uma redução no tamanho de um conflito
implica numa resolução mais rápida pelo desenvolvedor.
\subsubsection{Conflito Resolvido}
Um Conflito Resolvido significa um conflito que é relatado pela ferramenta \emph{diff3},
mas não é relatado pela ferramenta \emph{CSDiff}, e
além disso, o resultado do \emph{CSDiff} para o bloco de código associado a esse conflito é o mesmo resultado
observado no resultado
final do merge. Este é a melhor das situações analisadas nessa pergunta de pesquisa, pois indica um conflito a menos para o
desenvolvedor resolver (um conflito resolvido automaticamente pelo \emph{CSDiff} mas nao pelo \emph{diff3}). Dessa forma,
escolhemos a pontuação +2 para essa situação.
\subsubsection{Conflito Extra}
Um Conflito Extra é definido como um conflito que não existe
no \emph{diff3}, mas que existe no \emph{CSDiff} do arquivo em questão. Essa
situação pode ser causada por conflito que foi automaticamente
resolvido pelo \emph{diff3}, mas não pelo \emph{CSDiff}, indicando um conflito
a mais para o desenvolvedor resolver caso ele utilize o \emph{CSDiff}
ao invés do \emph{Diff3}. Por isso, escolhemos a pontuação -1 para essa
situação.
\subsubsection{Falso Negativo CSDiff}
Um Falso Negativo CSDiff nesse contexto indica um conflito que foi relatado no
\emph{diff3}, mas não no \emph{CSDiff} (indicando que
o \emph{CSDiff} resolveu um conflito que o \emph{diff3} não resolveu),
e o resultado dessa resolução de Conflito é diferente do resultado
observado no merge do repositório. Essa é a pior situação possível,
dado que quando um conflito é resolvido de forma errada,
o código resultante poderá apresentar comportamento inesperado ou não funcionar. Por
isso, escolhemos a pontuação -2 para esse caso.

\section{AMOSTRA}
Como amostra para essa pesquisa, utilizamos os mesmos critérios de escolha
usados nos trabalhos anteriores e foram selecionados 10 projetos open source majoritariamente escritos em Python,
cada um com mais de 13000 estrelas no github e mais de 370 contribuidores cada.
% TODO: adicionar tabela de projetos

\section{METODOLOGIA}\label{metodologia}
Para comparar o CSDiff e o diff3, primeiro mineramos os commits de merge para os 10 projetos escolhidos, considerando um
intervalo de um ano (entre 1/1/2021 e 1/1/2022). Esta mineração foi feita utilizando o miningframework, como nos trabalhos
anteriores e, com o objetivo de analisar o novo algoritmo (Figura \ref{csdiff_process_indentation}) em comparação com o já
existente (Figura \ref{csdiff_process}), bem como analisar a influência da escolha de certos separadores para a linguagem Python,
essa mineração foi feita 4 vezes, a saber:

\begin{compactenum}[(1)]
	\item Algoritmo antigo, com separadores "( ) , :". Chamemos de CSDiff+
	\item Algoritmo antigo, com separadores "( ) ,". Chamemos de CSDiff-
	\item Algoritmo novo, com separadores "( ) , :". Chamemos de CSDiffI+
	\item Algoritmo novo, com separadores "( ) ,". Chamemos de CSDiffI-
\end{compactenum}

Decidimos testar a influência do separador ":" (dois pontos) pois em Python este separador usualmente vem seguido de uma
mudança de indentação, então nesses casos, o algoritmo novo irá adicionar linhas marcadoras de forma redundante (pois
durante a execução irá detectar tanto o separador quanto a mudança de indentação, ao invés de somente um dos dois)

Após a mineração, o miningframework executa automaticamente as duas ferramentas em todos os arquivos de cada cenário de merge
minerado, e em seguida cria uma tabela com dados relevantes como número de conflitos por
ferramenta, por cenário, número de arquivos com conflitos, etc. Para este passo, somente foi necessário utilizar
o CSDiffModule, um módulo do miningframework já existente e que já foi utilizado também em estudos anteriores.

Além disso, alguns scripts feitos em Bash pelo autor foram necessários para complementar os dados que não eram obtidos
diretamente destas tabelas. Todos esses scripts estão disponibilizados em um repositório público. % TODO: adicionar footnote

Para contar conflitos por arquivo,
cenário, etc., os scripts buscam por marcadores
de conflito nos textos dos arquivos. Para identificar se as ferramentas deram o mesmo resultado,
ou resultado idêntico ao do merge
do repositório, comparamos textualmente (ignorando espaços em
branco) o arquivo de merge do repositório, e os arquivos resultante da execução de cada
ferramenta no cenário de merge correspondente.

Todos esses passos foram executados localmente em uma máquina operando com sistema operacional Ubuntu 22.04.2,
com 16GB de memória
RAM e um processador Intel Core i7.

\section{RESULTADOS}
Para a nossa amostra, foram coletados 3788 cenários de merge. Destes, apenas 32 foram considerados, por possuírem resultado
diferente entre as duas ferramentas. Todos os casos onde o resultado do CSDiff era o mesmo do diff3
foram deletados pois não fariam
diferença para a análise comparativa.

Como poderemos ver nas seções seguintes, foi observado uma peculiaridade na nossa amostra. Um dos projetos escolhidos, o
matplotlib, possui uma quantidade muito maior de conflitos e aFPs relatados do que todos os outros projetos juntos. Ao remover
as quantidades relativas a este projeto, obtemos um resultado dentro do esperado, dados os resultados obtidos
em~\cite{clem21,heitor21}. A causa desse problema será discutida na seção \ref{discussao}.

\subsection{PP1: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	reduz a quantidade de conflitos reportados em comparação ao \emph{merge} puramente textual?}
Para respoder essa pergunta, analisamos a quantidade de conflitos por cenário obtidos da execução do experimento. Os
resultados para todas as execuções podem ser vistos na Tabela \ref{tabelaPP1_com_matplotlib} e na
Tabela \ref{tabelaPP1_sem_matplotlib}

\begin{table}[ht]
	\begin{center}
		\begin{tabular}{|l|c|c|c|c|c|}
			\hline
			\textbf{Tipo de conflito} & \textbf{diff3} & \textbf{CSDiff+} & \textbf{CSDiff-} & \textbf{CSDiffI+} & \textbf{CSDiffI-} \\
			\hline
			Conflitos                 & 100            & 177              & 146              & 277               & 237               \\
			Arquivos com conflitos    & 52             & 58               & 52               & 74                & 76                \\
			Cenários com conflitos    & 30             & 24               & 23               & 24                & 26                \\
			\hline
		\end{tabular}
	\end{center}
	\caption{Quantidade de conflitos encontrados após execução do experimentos}\label{tabelaPP1_com_matplotlib}
\end{table}

\begin{table}[ht]
	\begin{center}
		\begin{tabular}{|l|c|c|c|c|c|}
			\hline
			\textbf{Tipo de conflito} & \textbf{diff3} & \textbf{CSDiff+} & \textbf{CSDiff-} & \textbf{CSDiffI+} & \textbf{CSDiffI-} \\
			\hline
			Conflitos                 & 59             & 51               & 51               & 54                & 52                \\
			Arquivos com conflitos    & 29             & 20               & 19               & 21                & 22                \\
			Cenários com conflitos    & 22             & 15               & 14               & 15                & 17                \\
			\hline
		\end{tabular}
	\end{center}
	\caption{Quantidade de conflitos encontrados após execução do experimentos, desconsiderando o projeto matplotlib}\label{tabelaPP1_sem_matplotlib}
\end{table}

Observamos que, considerando todos os projetos (Tabela \ref{tabelaPP1_com_matplotlib}), a quantidade de conflitos aumenta
razoavelmente, apresentando um aumento mínimo de 46\% para o CSDiff- e máximo de 177\% para o CSDiffI+, o que é esperado dado que o
CSDiff tende a quebrar os conflitos do diff3 em conflitos menores, devido a forma como ele processa os arquivos em seu algoritmo.
O estudo anterior feito com Java~\cite{clem21} segue no mesmo caminho, apresentando um aumento de 35\% para um conjunto menor de
separadores e 105\% para um conjunto maior de separadores.

Percebe-se também a influência do novo algoritmo no resultado. O CSDiffI+ e o CSDiffI- demonstraram aumentos de quantidade de
conflitos muito maiores que os CSDiff+ e CSDiff-, indicando que o novo algoritmo não é tão benéfico quando comparado com a
versão já existente.

\subsection{PP2: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	reduz a quantidade de cenários com conflitos reportados em comparação ao \emph{merge} puramente textual?}
\subsection{PP3: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	reduz a quantidade de falsos conflitos e cenários com falsos conflitos reportados
	(falsos positivos) em comparação ao \emph{merge} puramente textual?}
\subsection{PP4: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	amplia a possibilidade de comprometer a corretude do código, por aumentar o número de
	integrações de mudanças que interferem uma na outra, sem reportar conflitos (falsos negativos),
	além de aumentar cenários com falsos negativos?}
\subsection{PP5: A nova solução de \emph{merge} não estruturado, utilizando indentação,
	demonstra um aumento de produtividade considerando o ato de resolver conflitos de merge?}

\section{DISCUSSÃO}\label{discussao}
\section{AMEAÇAS A VALIDADE}


































